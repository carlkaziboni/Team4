<!DOCTYPE html>
<html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet'>
    <title>Stripe Gradient</title>
    <link rel="stylesheet" href="static/styles.css">
    <script src="static/Gradient.js"></script>
</head>
<style>
    body {
        margin:0;
        padding:0;
    }
    #gradient-canvas {
        --gradient-color-1: #EEEEEB;
        --gradient-color-2: #D1E9B8;
        --gradient-color-3: #bbd1b5;
        --gradient-color-4: #cde2d1;
    }
</style>
<body>
    <canvas id="gradient-canvas" style="width:100vw;height:100vh"></canvas>
    
    <!-- Content over the canvas -->
    <div class="content" style="position: absolute; top: 2.5%;  left:5%; text-align: center;
            color: white;">
        <h1> Data Dashboard </h1>

        <!-- NEW STUFF   -->

        <div class="date-picker">
            <label for="start-date">Start Date:</label>
            <input type="date" id="start-date">
        
            <label for="end-date">End Date:</label>
            <input type="date" id="end-date">
        
            <button onclick="submitDates()">Submit Dates</button>
            <p id="date-error" style="color: red; display: none;">End date must be after the start date!</p>
        </div>

        <!-- NEW STUFF   -->
        

        <div class="container">
            <!-- Large Image on the left -->
            <div class="large-image">
                <img id="large-image" src="static/graph.png" alt="Large Image">
            </div>

            <!-- Small Images on the right -->
            <div class="small-images">
                <img src="static/graph1.png" alt="Small Image 1" onclick="swapImages(this)">
                <img src="static/random2.webp" alt="Small Image 2" onclick="swapImages(this)">
                <img src="static/random4.png" alt="Small Image 3" onclick="swapImages(this)">
            </div>

            <!-- Editable Text Box on the right -->
            <div class="text-box">
                <textarea id="editable-text" rows="10" cols="30" placeholder="" readonly>{{ text }}</textarea>
            </div>
        </div>
    </div>
    <script>
        var gradient = new Gradient();
        gradient.initGradient('#gradient-canvas');

        function swapImages(clickedImage) {
            var largeImage = document.getElementById("large-image"); // Get the large image
            var clickedImageSrc = clickedImage.src; // Get the source of the clicked image

            // Swap the sources
            var currentLargeImageSrc = largeImage.src;
            largeImage.src = clickedImageSrc;
            clickedImage.src = currentLargeImageSrc;
        }

    // Function to send updated text to Flask backend
    function updateText() {
        var text = document.getElementById("editable-text").value; // Get the value from textarea
        fetch("/update_text", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
            },
            body: "text=" + encodeURIComponent(text),
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                console.log("Text updated successfully");
            }
        });
    }

    // Trigger text update when text box loses focus
    document.getElementById("editable-text").addEventListener('blur', updateText);

    /* NEW STUFF */
    function submitDates() {
        let startDate = document.getElementById("start-date").value;
        let endDate = document.getElementById("end-date").value;
        let errorMsg = document.getElementById("date-error");
    
        // Convert to Date objects for validation
        let start = new Date(startDate);
        let end = new Date(endDate);
    
        if (!startDate || !endDate) {
            errorMsg.innerText = "Both dates must be selected!";
            errorMsg.style.display = "block";
            return;
        }
    
        if (end <= start) {
            errorMsg.innerText = "End date must be after the start date!";
            errorMsg.style.display = "block";
            return;
        }
    
        // Hide error message if validation passed
        errorMsg.style.display = "none";
    
        // Send data to backend
        fetch("/submit_dates", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ start_date: startDate, end_date: endDate }),
        })
        .then(response => response.json())
        .then(data => {
            console.log("Response from server:", data);
            alert("Dates submitted successfully!");
        })
        .catch(error => console.error("Error:", error));
    }
    /* */
    



    </script>
</body>
</html>